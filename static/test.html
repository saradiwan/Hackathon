<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>India Solar Site Suitability</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body { font-family: 'Poppins', sans-serif; background: #0b1c2c; color: #e6eef8; margin:0; padding:0; }
#map { height: 500px; width: 100%; border-radius:12px; }
.glass { background: rgba(255,255,255,0.03); border-radius:12px; padding:1rem; margin-bottom:1rem; }
.progress-bg { background: rgba(255,255,255,0.12); border-radius:12px; height:28px; width:100%; }
.progress-fill { height:28px; border-radius:12px; background:white; text-align:center; color:#082033; font-weight:600; line-height:28px; transition:width 0.5s ease; }
.loader { border: 3px solid #f3f3f3; border-top: 3px solid #fff; border-radius: 50%; width: 18px; height: 18px; animation: spin 1s linear infinite; display: inline-block; margin-right: 6px; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.pulse { animation: pulse 1s infinite; border-radius: 50%; border: 3px solid #00ff00; }
@keyframes pulse { 0% { transform: scale(1); opacity:1;} 50% { transform: scale(1.5); opacity:0.5;} 100% { transform: scale(1); opacity:1;} }
</style>
</head>

<body class="p-4 md:p-8">

<header class="mb-6">
<h1 class="text-2xl md:text-3xl font-bold">üåû India Solar Site Suitability ‚Äî Real-time</h1>
<p class="text-sm text-gray-300">Select a city or click on the map to get NASA POWER solar data + ML prediction.</p>
</header>

<main class="grid grid-cols-1 lg:grid-cols-2 gap-4">

<div>
<div class="glass">
<label class="block mb-2 font-semibold">Select City:</label>
<select id="citySelect" class="w-full p-2 rounded-md bg-[#082a38] text-white">
  <option value="">-- Select a city --</option>
</select>
<p class="text-xs text-gray-400 mt-2">Or click anywhere on the map to analyze that location.</p>
</div>

<div class="glass">
<h2 class="font-semibold mb-2">Real-time Features</h2>
<div id="features" class="space-y-1 text-sm text-gray-100">
  <div>Latitude: <span id="lat">‚Äî</span></div>
  <div>Longitude: <span id="lon">‚Äî</span></div>
  <div>Solar (irradiance): <span id="solar">‚Äî</span></div>
  <div>Elevation: <span id="elev">‚Äî</span> m</div>
  <div>Slope: <span id="slope">‚Äî</span> ¬∞</div>
  <div>AI Land Score: <span id="landai">‚Äî</span></div>
  <div>Model label: <span id="lab">‚Äî</span></div>
  <div>Model confidence: <span id="prob">‚Äî</span></div>
</div>
</div>

<div class="glass">
<h2 class="font-semibold mb-2">AHP Sub-Criteria</h2>
<div id="subCriteria" class="grid grid-cols-2 gap-2 text-sm text-gray-100"></div>
</div>

<div class="glass text-center">
<h2 class="font-semibold mb-2">Final Suitability</h2>
<div class="progress-bg mb-2">
<div id="progressFill" class="progress-fill">0%</div>
</div>
<div id="recommendation" class="text-lg font-semibold">‚Äî</div>
</div>
</div>

<div id="map"></div>

</main>

<script>
// DOM Elements
const latEl=document.getElementById('lat'),
      lonEl=document.getElementById('lon'),
      solarEl=document.getElementById('solar'),
      elevEl=document.getElementById('elev'),
      slopeEl=document.getElementById('slope'),
      landaiEl=document.getElementById('landai'),
      progressFill=document.getElementById('progressFill'),
      recElem=document.getElementById('recommendation'),
      labEl=document.getElementById('lab'),
      probEl=document.getElementById('prob'),
      subDiv=document.getElementById('subCriteria');

// Cities List
const sel = document.getElementById("citySelect");
const cities = [
  {name:"Delhi",lat:28.7041,lon:77.1025},
  {name:"Mumbai",lat:19.0760,lon:72.8777},
  {name:"Kolkata",lat:22.5726,lon:88.3639},
  {name:"Chennai",lat:13.0827,lon:80.2707},
  {name:"Bengaluru",lat:12.9716,lon:77.5946},
  {name:"Hyderabad",lat:17.3850,lon:78.4867},
  {name:"Ahmedabad",lat:23.0225,lon:72.5714},
  {name:"Pune",lat:18.5204,lon:73.8567},
  {"name":"Pune","lat":18.5204,"lon":73.8567},
  {"name":"Surat","lat":21.1702,"lon":72.8311},
  {"name":"Jaipur","lat":26.9124,"lon":75.7873},
  {"name":"Lucknow","lat":26.8467,"lon":80.9462},
  {"name":"Kanpur","lat":26.4499,"lon":80.3319},
  {"name":"Nagpur","lat":21.1458,"lon":79.0882},
  {"name":"Indore","lat":22.7196,"lon":75.8577},
  {"name":"Thane","lat":19.2183,"lon":72.9781},
  {"name":"Bhopal","lat":23.2599,"lon":77.4126},
  {"name":"Visakhapatnam","lat":17.6868,"lon":83.2185},
  {"name":"Patna","lat":25.5941,"lon":85.1376},
  {"name":"Vadodara","lat":22.3072,"lon":73.1812},
  {"name":"Ghaziabad","lat":28.6692,"lon":77.4538},
  {"name":"Ludhiana","lat":30.9000,"lon":75.8573},
  {"name":"Agra","lat":27.1767,"lon":78.0081},
  {"name":"Nashik","lat":19.9975,"lon":73.7898},
  {"name":"Faridabad","lat":28.4211,"lon":77.3078},
  {"name":"Meerut","lat":28.9845,"lon":77.7064},
  {"name":"Rajkot","lat":22.3039,"lon":70.8022},
  {"name":"Kalyan","lat":19.2437,"lon":73.1355},
  {"name":"Vasai-Virar","lat":19.3919,"lon":72.8397},
  {"name":"Varanasi","lat":25.3176,"lon":82.9739},
  {"name":"Srinagar","lat":34.0837,"lon":74.7973},
  {"name":"Aurangabad","lat":19.8762,"lon":75.3433},
  {"name":"Dhanbad","lat":23.7957,"lon":86.4304},
  {"name":"Amritsar","lat":31.6340,"lon":74.8723},
  {"name":"Navi Mumbai","lat":19.0330,"lon":73.0297},
  {"name":"Allahabad","lat":25.4358,"lon":81.8463},
  {"name":"Howrah","lat":22.5958,"lon":88.2636},
  {"name":"Ranchi","lat":23.3441,"lon":85.3096},
  {"name":"Gwalior","lat":26.2183,"lon":78.1828},
  {"name":"Jabalpur","lat":23.1815,"lon":79.9864},
  {"name":"Coimbatore","lat":11.0168,"lon":76.9558},
  {"name":"Vijayawada","lat":16.5062,"lon":80.6480},
  {"name":"Madurai","lat":9.9252,"lon":78.1198},
  {"name":"Raipur","lat":21.2514,"lon":81.6296},
  {"name":"Kota","lat":25.2138,"lon":75.8648},
  {"name":"Guwahati","lat":26.1445,"lon":91.7362},
  {"name":"Chandigarh","lat":30.7333,"lon":76.7794},
  {"name":"Solapur","lat":17.6599,"lon":75.9064},
  {"name":"Hubli-Dharwad","lat":15.3647,"lon":75.1240},
  {"name":"Bareilly","lat":28.3670,"lon":79.4304},
  {"name":"Moradabad","lat":28.8386,"lon":78.7733},
  {"name":"Mysuru","lat":12.2958,"lon":76.6394},
  {"name":"Gurugram","lat":28.4595,"lon":77.0266},
  {"name":"Aligarh","lat":27.8974,"lon":78.0880},
  {"name":"Jalandhar","lat":31.3260,"lon":75.5762},
  {"name":"Bhubaneswar","lat":20.2961,"lon":85.8245},
  {"name":"Tiruchirappalli","lat":10.7905,"lon":78.7047},
  {"name":"Salem","lat":11.6643,"lon":78.1460},
  {"name":"Warangal","lat":17.9689,"lon":79.5941},
  {"name":"Guntur","lat":16.3067,"lon":80.4365},
  {"name":"Bhiwandi","lat":19.3002,"lon":73.0588},
  {"name":"Saharanpur","lat":29.9671,"lon":77.5510},
  {"name":"Gorakhpur","lat":26.7606,"lon":83.3732},
  {"name":"Bikaner","lat":28.0229,"lon":73.3119},
  {"name":"Amravati","lat":20.9374,"lon":77.7796},
  {"name":"Noida","lat":28.5355,"lon":77.3910},
  {"name":"Jamshedpur","lat":22.8046,"lon":86.2029},
  {"name":"Bhavnagar","lat":21.7645,"lon":72.1519},
  {"name":"Jodhpur","lat":26.2389,"lon":73.0243},
  {"name":"Shillong","lat":25.5788,"lon":91.8933},
  {"name":"Udaipur","lat":24.5854,"lon":73.7125},
  {"name":"Raichur","lat":16.2100,"lon":77.3550},
  {"name":"Mangalore","lat":12.9141,"lon":74.8560},
  {"name":"Belagavi","lat":15.8497,"lon":74.4977},
  {"name":"Dehradun","lat":30.3165,"lon":78.0322},
  {"name":"Jammu","lat":32.7266,"lon":74.8570},
  {"name":"Asansol","lat":23.6850,"lon":86.9833},
  {"name":"Durgapur","lat":23.5204,"lon":87.3119},
  {"name":"Sangli","lat":16.8524,"lon":74.5815},
  {"name":"Nellore","lat":14.4426,"lon":79.9865},
  {"name":"Tirupati","lat":13.6288,"lon":79.4192},
  {"name":"Kolhapur","lat":16.7049,"lon":74.2433},
  {"name":"Ajmer","lat":26.4499,"lon":74.6399},
  {"name":"Gaya","lat":24.7955,"lon":85.0002},
  {"name":"Ujjain","lat":23.1765,"lon":75.7885},
  {"name":"Jhansi","lat":25.4484,"lon":78.5685},
  {"name":"Muzaffarpur","lat":26.1209,"lon":85.3647},
  {"name":"Mathura","lat":27.4924,"lon":77.6737},
  {"name":"Rohtak","lat":28.8950,"lon":76.6066},
  {"name":"Hisar","lat":29.1492,"lon":75.7217},
  {"name":"Ambala","lat":30.3782,"lon":76.7767},
  {"name":"Rewa","lat":24.5362,"lon":81.3030},
  {"name":"Satna","lat":24.6005,"lon":80.8322},
  {"name":"Haridwar","lat":29.9457,"lon":78.1642},
  {"name":"Rourkela","lat":22.2604,"lon":84.8536},
  {"name":"Bilaspur","lat":22.0797,"lon":82.1409},
  {"name":"Anantapur","lat":14.6819,"lon":77.6006},
  {"name":"Karimnagar","lat":18.4386,"lon":79.1288},
  {"name":"Kakinada","lat":16.9891,"lon":82.2475},
  {"name":"Tirunelveli","lat":8.7139,"lon":77.7567},
  {"name":"Nagercoil","lat":8.1833,"lon":77.4119},
  {"name":"Erode","lat":11.3410,"lon":77.7172},
  {"name":"Thanjavur","lat":10.7867,"lon":79.1378},
  {"name":"Vellore","lat":12.9165,"lon":79.1325},
  {"name":"Kollam","lat":8.8932,"lon":76.6141},
  {"name":"Kochi","lat":9.9312,"lon":76.2673},
  {"name":"Thiruvananthapuram","lat":8.5241,"lon":76.9366},
  {"name":"Thrissur","lat":10.5276,"lon":76.2144},
  {"name":"Kannur","lat":11.8745,"lon":75.3704},
  {"name":"Kozhikode","lat":11.2588,"lon":75.7804},
  {"name":"Imphal","lat":24.8170,"lon":93.9368},
  {"name":"Aizawl","lat":23.7271,"lon":92.7176},
  {"name":"Itanagar","lat":27.0844,"lon":93.6053},
  {"name":"Kohima","lat":25.6751,"lon":94.1086},
  {"name":"Agartala","lat":23.8315,"lon":91.2868},
  {"name":"Port Blair","lat":11.6234,"lon":92.7265},
  {"name":"Panaji","lat":15.4909,"lon":73.8278},
  {"name":"Margao","lat":15.2832,"lon":73.9862},
  {"name":"Shimla","lat":31.1048,"lon":77.1734},
  {"name":"Dharamshala","lat":32.2190,"lon":76.3234},
  {"name":"Manali","lat":32.2432,"lon":77.1892},
  {"name":"Hamirpur","lat":31.6857,"lon":76.5213},
  {"name":"Pathankot","lat":32.2643,"lon":75.6421},
  {"name":"Patiala","lat":30.3398,"lon":76.3869},
  {"name":"Bathinda","lat":30.2109,"lon":74.9455},
  {"name":"Hoshiarpur","lat":31.5323,"lon":75.9115},
  {"name":"Mohali","lat":30.7046,"lon":76.7179},
  {"name":"Panchkula","lat":30.6942,"lon":76.8606},
  {"name":"Alwar","lat":27.5520,"lon":76.6346},
  {"name":"Bharatpur","lat":27.2152,"lon":77.4924},
  {"name":"Sikar","lat":27.6094,"lon":75.1399},
  {"name":"Tonk","lat":26.1640,"lon":75.7895},
  {"name":"Churu","lat":28.2920,"lon":74.9677},
  {"name":"Dausa","lat":26.8945,"lon":76.3323},
  {"name":"Palwal","lat":28.1487,"lon":77.3320},
  {"name":"Rewari","lat":28.1990,"lon":76.6183},
  {"name":"Panipat","lat":29.3925,"lon":76.9760},
  {"name":"Karnal","lat":29.6857,"lon":76.9905},
  {"name":"Yamunanagar","lat":30.1290,"lon":77.2674},
  {"name":"Kurukshetra","lat":29.9695,"lon":76.8783},
  {"name":"Sirsa","lat":29.5348,"lon":75.0280},
  {"name":"Fatehabad","lat":29.5110,"lon":75.4550},
  {"name":"Bhilai","lat":21.1938,"lon":81.3509},
  {"name":"Korba","lat":22.3595,"lon":82.7501},
  {"name":"Jagdalpur","lat":19.0740,"lon":82.0080},
  {"name":"Dewas","lat":22.9676,"lon":76.0534},
  {"name":"Ratlam","lat":23.3315,"lon":75.0367},
  {"name":"Hoshangabad","lat":22.7441,"lon":77.7369},
  {"name":"Betul","lat":21.9000,"lon":77.9000},
  {"name":"Seoni","lat":22.0869,"lon":79.5500},
  {"name":"Damoh","lat":23.8391,"lon":79.4417},
  {"name":"Gondia","lat":21.4624,"lon":80.2209},
  {"name":"Parbhani","lat":19.2700,"lon":76.7600},
  {"name":"Nanded","lat":19.1690,"lon":77.3130},
  {"name":"Beed","lat":18.9891,"lon":75.7600},
  {"name":"Latur","lat":18.4088,"lon":76.5604},
  {"name":"Osmanabad","lat":18.1860,"lon":76.0419},
  {"name":"Akola","lat":20.7096,"lon":77.0027},
  {"name":"Chandrapur","lat":19.9470,"lon":79.2961},
  {"name":"Yavatmal","lat":20.3888,"lon":78.1307}


];
cities.forEach(c=>{
  const opt=document.createElement("option");
  opt.value=`${c.lat},${c.lon}`;
  opt.textContent=c.name;
  sel.appendChild(opt);
});

// Map
const map = L.map('map').setView([22.7196,75.8577], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
const marker = L.marker([22.7196,75.8577]).addTo(map);

function finalRecommendation(label, ahp){
  if(ahp >= 0.8) return "üåû Excellent Site (Highly Suitable)";
  if(ahp >= 0.55) return "‚ö†Ô∏è Moderate Site (Can Be Considered)";
  return "‚ùå Poor Site (Not Recommended)";
}

function showLoading(){
  recElem.innerHTML = `<div class="loader"></div> Fetching‚Ä¶`;
  progressFill.style.width = "10%";
}

function updateUIFromResponse(resp, lat, lon, cityName){
  latEl.innerText = lat.toFixed(5);
  lonEl.innerText = lon.toFixed(5);
  solarEl.innerText = resp.irradiance?.toFixed(3) || "N/A";
  elevEl.innerText = resp.elevation?.toFixed(1) || "N/A";
  slopeEl.innerText = resp.slope?.toFixed(2) || "N/A";
  landaiEl.innerText = resp.landai?.toFixed(2) || "N/A";
  labEl.innerText = resp.label || "‚Äî";
  probEl.innerText = (resp.probability*100)?.toFixed(1)+"%" || "‚Äî";

  const percent=Math.round(resp.ahp_score*100);
  progressFill.style.width=percent+"%";
  progressFill.innerText=percent+"%";
  recElem.innerText = finalRecommendation(resp.label, resp.ahp_score);

  subDiv.innerHTML="";
  if(resp.site_values){
    for(const [k,v] of Object.entries(resp.site_values)){
      const color = v>=0.7?"text-green-400":v>=0.4?"text-orange-400":"text-red-400";
      const el = document.createElement("div");
      el.innerHTML=`<span class="${color} font-semibold">${k}:</span> ${v.toFixed(3)}`;
      subDiv.appendChild(el);
    }
  }

  const iconEl = marker.getElement();
  if(iconEl) iconEl.classList.add("pulse");
  marker.bindTooltip(`${cityName || "Location"}<br>Irradiance: ${resp.irradiance?.toFixed(2)}`, {permanent:false}).openTooltip();
}

async function analyzeAt(lat, lon, cityName){
  showLoading();
  try{
    const res=await fetch('http://127.0.0.1:5000/predict',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({lat, lon})
    });
    if(!res.ok){ recElem.innerText="Error"; return; }
    const data=await res.json();
    updateUIFromResponse(data, lat, lon, cityName);
  }catch(err){
    recElem.innerText="Error";
    console.error(err);
  }
}

sel.addEventListener("change", () => {
  if(!sel.value) return;
  const [lat, lon] = sel.value.split(",").map(Number);
  const cityName = sel.options[sel.selectedIndex].text;
  map.flyTo([lat, lon], 12, {animate:true,duration:2});
  setTimeout(() => {
    marker.setLatLng([lat, lon]);
    analyzeAt(lat, lon, cityName);
  }, 2000);
});

map.on("click", e=>{
  const {lat, lng} = e.latlng;
  marker.setLatLng([lat, lng]);
  analyzeAt(lat, lng, "Clicked Location");
});

// Initial load
analyzeAt(22.7196,75.8577,"Default Location");

</script>

<a id="chartsBtn" href="chart.html">
    <button class="mt-4 p-2 bg-blue-600 rounded text-white hover:bg-blue-700">View Analytics Charts</button>
</a>

<script>
// Prevent chart view if city not selected
const chartsBtn = document.getElementById('chartsBtn');
chartsBtn.addEventListener('click', (e) => {
    const cityName = sel.value ? sel.options[sel.selectedIndex].text : "";
    if (!cityName) {
        e.preventDefault(); // prevent navigation
        alert("Please select a city first to view analytics charts.");
    } else {
        chartsBtn.href = `/charts?city=${encodeURIComponent(cityName)}`;
    }
});

// Update link dynamically when city selected
sel.addEventListener("change", () => {
    const cityName = sel.options[sel.selectedIndex].text;
    chartsBtn.href = `/charts?city=${encodeURIComponent(cityName)}`;
});
</script>

</body>
</html>
